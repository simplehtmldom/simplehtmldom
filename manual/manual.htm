<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="pragma" content="no-cache">
<link href="default.css" rel="stylesheet" type="text/css">
<title>PHP Simple HTML DOM Parser</title>
<link href="css/default.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/ui.tabs.css" type="text/css" media="print, projection, screen">
<script src="js/jquery-1.2.3.pack.js"></script>
<script src="js/ui.tabs.pack.js" type="text/javascript"></script>
<script language="JavaScript" type="text/JavaScript">
	$(document).ready(function(){
		$(function() {$('#container-1 > ul').tabs();});
		$(function() {$('#container-2 > ul').tabs();});
		$(function() {$('#container-3 > ul').tabs();});
		$(function() {$('#container-4 > ul').tabs();});
		$(function() {$('#container-5 > ul').tabs();});
		$(function() {$('#container-6 > ul').tabs();});
	});
</script>
</head>
<body>
<h1 align="center">PHP Simple HTML DOM Parser Manual </h1>
<div id="content">
    <h2>Index</h2>
    <ul>
        <li><a href="#section_1">How to create HTML DOM object?</a></li>
        <li><a href="#section_2">How to get HTML elements?</a></li>
        <li><a href="#section_3">How to access the HTML element's attributes?</a> </li>
        <li><a href="#section_4">How to get HTML contents from DOM object?</a></li>
        <li><a href="#section_5">How to customize the parsing behavior?</a></li>
        <li><a href="#section_6">FAQ</a></li>
    </ul>
    <a name="section_1"></a>
    <h2>How to create HTML DOM object?</h2>
    <div id="container-1">
        <ul>
            <li><a href="#fragment-11"><span>Quick way</span></a></li>
            <li><a href="#fragment-12"><span>Object-oriented way</span></a></li>
        </ul>
        <div id="fragment-11">
            <div class="code"> <span class="comment">// Create a DOM object from a string </span><br>
                $dom = <strong>str_get_dom</strong>(<span class="var">'&lt;html&gt;&lt;body&gt;Hello!&lt;/body&gt;&lt;/html&gt;'</span>);<br>
                <br>
                <span class="comment">// Create DOM object from a URL </span><br>
                $dom = <strong>file_get_dom</strong>(<span class="var">'http://www.google.com/'</span>);<br>
                <br>
                <span class="comment">// Create DOM object from a file</span> <br>
                $dom = <strong>file_get_dom</strong>(<span class="var">'test.htm'</span>); <span class="comment"></span><span class="comment"><br>
                </span></div>
        </div>
        <div id="fragment-12">
            <div class="code"><span class="comment"> </span> <span class="comment">// Create DOM object</span><br>
                $dom = new <strong>html_dom_parser</strong>();<br>
                <br>
                <span class="comment">// Load contents from a string </span><br>
                $dom-&gt;<strong>load</strong>(<span class="var">'&lt;html&gt;&lt;body&gt;Hello!&lt;/body&gt;&lt;/html&gt;'</span>);<br>
                <br>
                <span class="comment">// Load contents from a URL </span> <br>
                $dom-&gt;<strong>load_file</strong>(<span class="var">'http://www.google.com/'</span>);<br>
                <br>
                <span class="comment">// Load contents from a file</span> <br>
                $dom-&gt;<strong>load_file</strong>(<span class="var">'test.htm'</span>);</div>
        </div>
    </div>
    <a name="section_2"></a>
    <h2>How to get HTML elements?</h2>
    <div id="container-3">
        <ul>
            <li><a href="#fragment-31"><span>Basic selectors</span></a></li>
            <li><a href="#fragment-32"><span>Multiple selectors</span></a></li>
            <li><a href="#fragment-33"><span>Nested selectors</span></a></li>
        </ul>
        <div id="fragment-31">
            <div class="code"> <span class="comment">// Find all link &lt;a&gt;, returns a <strong>array</strong> of element objects </span><br>
                $result = $dom-&gt;<strong>find</strong>(<span class="var">'a'</span>);<br>
                <br>
                <span class="comment">// Find with index to access the <strong>Nth</strong> returned element object or <strong>null</strong> if not found</span><br>
                $dom-&gt;<strong>find</strong>(<span class="var">'a'</span>, <span class="var">0</span>)-&gt;<strong>href</strong>; <br>
                <br>
                <span class="comment">// Find all &lt;div&gt; which <strong>id</strong>=gbar</span><br>
                $result = $dom-&gt;<strong>find</strong>(<span class="var">'div#gbar'</span>);<br>
                <br>
                <span class="comment">// Find all &lt;span&gt; which <strong>class</strong>=gb1</span><br>
                $result = $dom-&gt;<strong>find</strong>(<span class="var">'span.gb1'</span>);<br>
                <br>
                <span class="comment">// Find all &lt;td&gt; which attribite align=center</span><br>
                $result = $dom-&gt;<strong>find</strong>(<span class="var">'td[align=&quot;center&quot;]'</span>);<br>
                <br>
                <span class="comment">// You can also omit the quotes from an attribute value for convenience</span><br>
                $result = $dom-&gt;<strong>find</strong>(<span class="var">'td[align=center]'</span>); <br>
                <br>
                <span class="comment">// Returns all children in the element </span><br>
                $result = $dom-&gt;<strong>find</strong>(<span class="var">'*'</span>); </div>
        </div>
        <div id="fragment-32">
            <div class="code"> <span class="comment">// Find all &lt;li&gt; in &lt;ul&gt; </span><br>
                $result = $dom-&gt;<strong>find</strong>(<span class="var">'ul li'</span>);<br>
                <br>
                <span class="comment">// Find Nested &lt;div&gt; </span><span class="comment">tags</span><br>
                $result = $dom-&gt;<strong>find</strong>(<span class="var">'div div div'</span>); <br>
                <br>
                <span class="comment">// Find all &lt;td&gt; in &lt;table&gt; which class=hello </span><br>
                $result = $dom-&gt;<strong>find</strong>(<var class="var">'table.hello td'</var>);<br>
                <br>
                <span class="comment">// Find all td tags with attribite align=center in table tags </span><br>
                $result = $dom-&gt;<strong>find</strong>(<span class="var">'<var class="var">'table</var> td[align=&quot;center&quot;]'</span>);<br>
            </div>
        </div>
        <div id="fragment-33">
            <div class="code"> <span class="comment">// Find all &lt;li&gt; in &lt;ul&gt; </span><br>
                foreach($dom-&gt;<strong>find</strong>(<span class="var">'ul'</span>) as $ul) <br>
                {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach($ul-&gt;<strong>find</strong>(<span class="var">'li'</span>) as $li) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="comment">// do something...</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                } <br>
                <br>
                <span class="comment">// Find first &lt;td&gt; in &lt;table&gt; which class=hello</span><br>
                foreach($dom-&gt;<strong>find</strong>(<span class="var">'table.hello'</span>) as $table) <br>
                {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo $table-&gt;<strong>find</strong>(<span class="var">'td'</span>, <span class="var">0</span>)-&gt;<strong>align</strong>; <br>
                } <br>
            </div>
        </div>
    </div>
    <a name="section_3"></a>
    <h2>How to access the HTML element's attributes?</h2>
    <div id="container-4">
        <ul>
            <li><a href="#fragment-41"><span>Get and Set attributes</span></a></li>
            <li><a href="#fragment-42"><span>Special attributes</span></a></li>
            <li><a href="#fragment-43"><span>Tips</span></a></li>
        </ul>
        <div id="fragment-41">
            <div class="code"><span class="comment">// Find first link</span><br>
                $element = $dom-&gt;<strong>find</strong>(<span class="var">'a'</span>, <span class="var">0</span>);<br>
                <br>
                <span class="comment">// Get attributes </span> <br>
                $value = $element-&gt;<strong>src</strong>;<br>
                $value = $element-&gt;<strong>alt</strong>;<br>
                <br>
                <span class="comment">// Set attributes</span><br>
                $element-&gt;<strong>src</strong> = <span class="var">'my link'</span>;<br>
                $element-&gt;<strong>alt</strong> = <span class="var">'hello'</span>; <br>
            </div>
        </div>
        <div id="fragment-42">
            <div class="code"><span class="comment">// For example</span> <br>
                $str = <span class="var">'&lt;div&gt;This is a &lt;strong&gt;test&lt;/strong&gt;&lt;/div&gt;'</span>;<br>
                <span class="hl-var">$dom</span><span class="hl-code"> = </span><strong>file_get_dom</strong><span class="hl-brackets">(</span>$str<span class="hl-brackets">)</span><span class="hl-code">;</span> <br>
                $element = $dom-&gt;find(<span class="var">'div'</span>, <span class="var">0</span>); <br>
                <br>
                <span class="comment">// Get type name of tag (eg. a, img, div...), returns: '<strong>div</strong>' </span><br>
                $value = $element-&gt;<strong>tag</strong>;<br>
                <br>
                <span class="comment">// Get outer html text, returns: '<strong>&lt;div&gt;This is a &lt;strong&gt;test&lt;/strong&gt;&lt;/div&gt;</strong>'; </span><br>
                $value = $element-&gt;<strong>outertext</strong>;<br>
                <br>
                <span class="comment">// Get inner html text, returns: '<strong>This is a &lt;strong&gt;test&lt;/strong&gt;</strong>'; </span><br>
                $value = $element-&gt;<strong>innertext</strong>;<br>
                <br>
                <span class="comment">// Get pure text, returns: '<strong>This is a test</strong>'; </span><br>
                $value = $element-&gt;<strong>plaintext</strong>;<br>
            </div>
        </div>
        <div id="fragment-43">
            <div class="code"><span class="comment">// Use <strong>isset</strong> function to test if a attribute is exist or not </span><br>
                if (isset($element-&gt;<strong>align</strong>)) { <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="comment">// do something...</span> <br>
                }<br>
                <br>
                <span class="comment">// Wrap a element like this</span><br>
                $element-&gt;<strong>outertext</strong> = <span class="var">'&lt;div class=&quot;wrap&quot;&gt;'</span> . $element-&gt;<strong>outertext</strong> . <span class="var">'&lt;div&gt;</span>'; <br>
                <br>
                <span class="comment">// Remove a element like this</span><br>
                $element-&gt;<strong>outertext</strong> = <span class="var">''</span>;<br>
            </div>
        </div>
    </div>
    <a name="section_4"></a>
    <h2>How to get HTML contents from DOM object?</h2>
    <div id="container-2">
        <ul>
            <li><a href="#fragment-21"><span>Object-oriented way</span></a></li>
            <li><a href="#fragment-22"><span>Another way</span></a></li>
        </ul>
        <div id="fragment-21">
            <div class="code"><span class="comment">// Get a string from dom object</span><br>
                $str = $dom-&gt;<strong>save</strong>();<br>
                <br>
                <span class="comment">// Write dom object contents to a file</span><br>
                $dom-&gt;<strong>save_file</strong>(<span class="var">'result.htm'</span>);</div>
        </div>
        <div id="fragment-22">
            <div class="code"> <span class="comment">// Get a string from dom object</span><br>
                $str = <strong>str_put_dom</strong>(<span class="var">$dom</span>);<br>
                <br>
                <span class="comment">// Writes dom object contents to a file</span><br>
                <strong>file_put_dom</strong>(<span class="var">'result.htm', $dom</span>);<br>
            </div>
        </div>
    </div>
    <a name="section_5"></a>
    <h2>How to customize the parsing behavior?</h2>
    <div id="container-5">
        <ul>
            <li><a href="#fragment-51"><span>Write a HTML text extractor</span></a></li>
            <li><a href="#fragment-52"><span>Tips</span></a></li>
        </ul>
        <div id="fragment-51">
            <div class="code"><span class="var">&lt;?php</span><br>
                <span class="comment">// example of how to customize the parsing behavior</span><br>
                include(<span class="var">'html_dom_parser.php'</span>);<br>
                <span class="comment"><br>
                // HTML text extractor</span><br>
                <strong>function</strong> html_extract_contents($str) {<br>
                <span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 1. create DOM object</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dom = new html_dom_parser; <span class="comment"><br>
                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 2. prepare HTML data and init everything</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dom-&gt;<strong>prepare</strong>($str); <span class="comment"><br>
                <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 3. some contents such as 'comments', 'styles' or 'script' will be treated as 'text',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// so we need to remove it before parsing, see the example for more details ...</span><br>
                <br>
                <span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 4. parsing each node</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret = '';<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ($node=$dom-&gt;<strong>parse</strong>()) {<br>
                <span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// dump contents of node which tag is 'text'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($node-&gt;tag==<span class="var">'text'</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= htmlspecialchars_decode($node-&gt;<strong>text</strong>());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $ret;<br>
                } <br>
                <br>
                <span class="comment">// test it!</span><br>
                $str = file_get_contents(<span class="var">'http://www.google.com/'</span>);<br>
                echo <strong>html_extract_contents</strong>($str);<br>
                <span class="var">?&gt;</span><br>
            </div>
        </div>
        <div id="fragment-52">
            <div class="code"> <br>
                The method &quot;find(...)&quot; always returns <strong>elements</strong>, but method &quot;parse()&quot; returns <strong>node</strong>.<br>
                One <strong>element</strong> may contains many <strong>nodes</strong>, for example, a <strong>element</strong> of &lt;a&gt; contains 3 <strong>nodes</strong>:<br>
                <br>
                <br>
&lt;a href=&quot;#&quot;&gt; &nbsp;<span class="var">&nbsp;</span>link0 &nbsp;<span class="var">&nbsp;&nbsp;</span><span class="var">&nbsp;&nbsp;</span><span class="var">&nbsp;</span>&lt;/a&gt;<br>
                <span class="var">----------------&nbsp;&nbsp;&nbsp;--------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--------</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="var">&nbsp;</span>node1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node2&nbsp;&nbsp;<span class="var">&nbsp;&nbsp;</span>node3<br>
                <br>
                <br>
                The attribute named $node-><strong>nodetype</strong> is particularly useful to identify the type of node while parsing. <br>
                Its value may be <span class="var">HDOM_TYPE_ELEMENT</span>, <span class="var">HDOM_TYPE_ENDTAG</span>, <span class="var">HDOM_TYPE_TEXT</span>. <br>
                <br>
                Lots of <strong>element's </strong> properties is not determined until the end of parsing loop, <br>
                calling any magic methods such as <strong>innertext</strong>, <strong>outertext, <strong>plaintext</strong></strong> will cause <span class="var">unexceptable errors</span>!<br>
                <br>
                While parsing, uses <strong>node's</strong> internal methods or array to prevent the problem.<br>
                <br>
            </div>
        </div>
    </div>
	<a name="section_6"></a>
    <h2>FAQ</h2>
    <div id="container-6">
        <ul>
            <li><a href="#fragment-61"><span>Memory leak</span></a></li>
        </ul>
        <div id="fragment-61">
            <div class="code"> <span class="var">Q:</span>                <br>
                This script is leaking memory seriously... After it finished running, it's not cleaning up dom object properly from memory.. <br>
                <br>
                <span class="var">A:</span>                <br>
                Due to php5 circular references memory leak, after creating DOM object, you must call $dom-&gt;clear() to free memory. <br>
example: <br>
<br>
$dom = file_get_dom(...); <br>
<span class="comment">// do something... </span><br>
$dom-&gt;clear(); <br>
unset($dom); <span class="comment"><br>
            </span></div>
        </div>
    </div>
</div>
<br>
</body>
</html>
